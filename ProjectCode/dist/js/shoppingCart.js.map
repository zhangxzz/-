{"version":3,"sources":["shoppingCart.js"],"names":["$","get","data","str","shoppingCart","forEach","value","goods_id","goods_name","goods_small_logo","goods_price","isChecked","num","appendTo","$allSelect","isAllChecked","computePrice","allPrice","filter","checked","reduce","prev","html","prop","console","log","this","obj","find","$goodsInput","change","id","each","index","error","is","parents","attr","on","_this","nowNum","_this2","_this3","remove","idx","findIndex","splice"],"mappings":"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","file":"shoppingCart.js","sourcesContent":["$(function () {\r\n    // 发送请求获取购物车的信息\r\n    $.get(\"/lession05/getShoppingCart\", function (data) {\r\n        var str = '';\r\n\r\n        data.data.forEach(value => {\r\n            str += \r\n            `<tr>\r\n                <td>\r\n                    <input data-id=\"${value.goods_id}\" type=\"checkbox\">\r\n                </td>\r\n                <td title=\"${value.goods_name}\">\r\n                    ${value.goods_name}\r\n                </td>\r\n                <td>\r\n                    <img src=\"${value.goods_small_logo}\"\r\n                        alt=\"\">\r\n                </td>\r\n                <td>\r\n                    ${value.goods_price}\r\n                </td>\r\n                <td>\r\n                ${value.num}\r\n                </td>\r\n                <td>\r\n                    <div class=\"dropdown\">\r\n                        <button class=\"btn btn-secondary dropdown-toggle\" type=\"button\" id=\"\"\r\n                            data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                            操作\r\n                        </button>\r\n                        <ul class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton1\">\r\n                            <li><a class=\"dropdown-item plus\" data-id=\"${value.goods_id}\"  href=\"#\">&plus;</a></li>\r\n                            <li><a class=\"dropdown-item minus\" data-id=\"${value.goods_id}\"  href=\"#\">&minus;</a></li>\r\n                            <li><a class=\"dropdown-item del\" data-id=\"${value.goods_id}\"  href=\"#\">&times;</a></li>\r\n                        </ul>\r\n                    </div>\r\n                </td>\r\n            </tr>`\r\n        })\r\n        $(str).appendTo(\"tbody\")\r\n\r\n\r\n        // 获取购物车中的数据\r\n        let shoppingCart = data.data;\r\n        // 获取元素添加功能\r\n        // 1 全选功能\r\n        let $allSelect = $(\"thead input\");\r\n        // 获取所有的tbody中的input\r\n        let $goodsInput = $(\"tbody input\");\r\n        // 小tips: 操作元素的checked属性的时候 要使用prop方法\r\n        // 当点击它的时候 有两种可能性1 全选 2取消\r\n        $allSelect.change(function () {\r\n            // console.log($(this).is(\":checked\"))\r\n            // 获取全选按钮的状态\r\n            let isChecked = $(this).prop(\"checked\");\r\n            // 同步商品input的状态\r\n            $goodsInput.prop(\"checked\", isChecked);\r\n\r\n            // 如果全选\r\n            if (isChecked) {\r\n                // 给数组中的每一个对象人为添加一条属性  checked并设置为true\r\n                shoppingCart.forEach(value => value.checked = true);\r\n            } else {\r\n                // 否则设置为false\r\n                shoppingCart.forEach(value => value.checked = false);\r\n            }\r\n\r\n            var allPrice = computePrice();\r\n        })\r\n\r\n\r\n        // 单个商品的选中和取消事件\r\n        $goodsInput.change(function () {\r\n            // 当点击任何一件商品的勾选框的时候会执行这里的代码\r\n            // 1 全选按钮的状态判定与修改\r\n            var isAllChecked = true;\r\n            $goodsInput.each(function (index, value) {\r\n                if (!$(value).is(\":checked\")) {\r\n                    // 有任何一个没有被选中 将 isAllChecked变量修改为false\r\n                    isAllChecked = false;\r\n                }\r\n            })\r\n            $allSelect.prop(\"checked\", isAllChecked);\r\n\r\n\r\n            // 2 获取商品信息\r\n            var id = $(this).attr(\"data-id\");\r\n            console.log(id)\r\n\r\n            // 根据商品id 拿到商品\r\n            var obj = shoppingCart.find(value => value.goods_id === id);\r\n            console.log(obj)\r\n            obj.checked = !obj.checked;\r\n\r\n\r\n            // 2 计算价格\r\n            computePrice();\r\n        })\r\n\r\n\r\n        // 使用委托模式添加增加数量事件\r\n        $(\"tbody\").on(\"click\", \".plus\", function () {\r\n            console.log(\"增加\")\r\n            // 1 发送增加商品的请求 给后端 \r\n            // 2 请求回来之后 再根据情况 加1或者不变\r\n            // 获取自定义属性 \r\n            let id = $(this).data('id')   // 等价于   let id = $(this).attr(\"data-id\")\r\n\r\n            $.get(\"/lession05/addToCart\", { id }, (data) => {\r\n                if (!data.error) {\r\n                    // 改变页面中的数量\r\n                    var nowNum = $(this).parents(\"td\").prev().html();  // 获取现在的数量\r\n                    $(this).parents(\"td\").prev().html(+nowNum + 1);// 改页面\r\n\r\n                    // 改变数组中的数量\r\n                    let obj = shoppingCart.find(value => value.goods_id == id);\r\n                    obj.num++;\r\n\r\n                    console.log(obj)\r\n\r\n                    // 计算价格\r\n                    computePrice();\r\n                }\r\n            })\r\n        })\r\n\r\n        $(\"tbody\").on(\"click\", \".minus\", function () {\r\n            console.log(\"减少\")\r\n            // 获取商品id\r\n            let id = $(this).data('id');\r\n            // 发送请求减少该商品的数量\r\n            $.get('/lession05/minusCart', { id }, (data) => {\r\n                if (!data.error) {\r\n                    // 减少数量成功\r\n                    var nowNum = $(this).parents(\"td\").prev().html();  // 获取现在的数量\r\n                    $(this).parents(\"td\").prev().html(+nowNum - 1); // 改页面\r\n\r\n                    // 改变数组中的数量\r\n                    let obj = shoppingCart.find(value => value.goods_id == id);\r\n                    obj.num--;\r\n\r\n                    console.log(obj)\r\n\r\n                    // 计算价格\r\n                    computePrice();\r\n                }\r\n            })\r\n        })\r\n        $(\"tbody\").on(\"click\", \".del\", function () {\r\n              // 获取商品id\r\n              let id = $(this).data('id');\r\n              // 发送请求减少该商品的数量\r\n              $.get('/lession05/deleteCart', { id }, (data) => {\r\n                  if (!data.error) {\r\n                      $(this).parents(\"tr\").remove();\r\n  \r\n                      // 改变数组中的数量\r\n                      let idx = shoppingCart.findIndex(value => value.goods_id == id);\r\n                      shoppingCart.splice(idx, 1)\r\n  \r\n                      // 计算价格\r\n                      computePrice();\r\n                  }\r\n              })\r\n        })\r\n\r\n\r\n\r\n        // 因为好多地方都用到了计算价格功能 所以单独封装成一个函数\r\n        function computePrice() {\r\n            // 先把所有checked属性为true的过滤出来  再计算过滤后的商品价格\r\n            // var checkShoppingCart = shoppingCart.filter(value => value.checked);\r\n            var checkShoppingCart = shoppingCart.filter((value) => {\r\n                return value.checked\r\n            });\r\n\r\n            var allPrice = checkShoppingCart.reduce((prev, value) => prev + value.goods_price * value.num, 0);\r\n\r\n            $(\"#allCount\").html(allPrice)\r\n        }\r\n\r\n    })\r\n})"]}